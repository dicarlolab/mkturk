(()=>{var e,t={26585:(e,t,i)=>{"use strict";i.r(t)},56772:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.taskParamSchema=void 0,t.taskParamSchema={title:"MkTurk Task Params",description:"Object containing MkTurk task parameters",type:["object","array"],properties:{Agent:{type:"string"},CheckRFID:{type:"integer"},Automator:{type:["string","integer"]},AutomatorFilePath:{type:"string",examples:["/mkturkfiles/paramterfiles/automators/touch_m2s_objectome.json"]},CurrentAutomatorStage:{type:"integer"},MinPercentCriterion:{type:"integer"},MinTrialsCriterion:{type:"integer"},DragtoRespond:{type:"integer"},CalibrateEye:{type:"integer"},NRSVP:{type:"integer"},SameDifferent:{type:"integer"},SamplingStrategy:{type:"string"},NStickyResponse:{type:"integer"},NTrialsPerBagBlock:{type:"integer"},NGridPoints:{type:"integer",minimum:1},GridSpacingInches:{type:"number"},GridXOffsetInches:{type:"number"},GridYOffsetInches:{type:"number"},FixationGridIndex:{type:"integer",minimum:-1},SampleGridIndex:{type:"integer",minimum:-1},ObjectGridIndex:{type:"array",items:{type:"integer",minimum:0}},ChoiceGridIndex:{type:"array",items:{type:"integer",minimum:0}},TestGridIndex:{type:"array",items:{type:"integer",minimum:0}},NFixations:{type:"integer",minimum:1},FixationUsesSample:{type:"integer"},FixationSizeInches:{type:"number"},FixationDuration:{type:"integer"},FixationTimeOut:{type:"integer"},FixationWindowSizeInches:{type:"number"},FixationDotSizeInches:{type:"number"},ImageBagsSample:{type:"array",items:{type:"string"}},KeepSampleON:{type:"integer"},SamplePRE:{type:"integer",minimum:0},SampleOFF:{type:"integer",minimum:0},ImageBagsTest:{type:"array",items:{type:"string"}},KeepTestON:{type:"integer"},TestOFF:{type:"integer"},HideTestDistractors:{type:"integer"},ChoiceSizeInches:{type:"number",minimum:0},HideChoiceDistractors:{type:"integer"},ChoiceTimeOut:{type:"integer",minimum:0},RewardStage:{type:"integer"},RewardPer1000Trials:{type:"integer"},NRewardMax:{type:"integer"},NConsecutiveHitsforBonus:{type:"integer"},PunishTimeOut:{type:"integer",minimum:0},ConsecutiveHitsITI:{type:"integer",minimum:0},InterTrialInterval:{type:"integer",minimum:0},BackgroundColor2D:{type:"string"},Homecage:{type:"integer"},Separated:{type:"integer"},Species:{type:"string",examples:["human","marmoset","model"]},Liquid:{type:"integer"}}}},48519:(e,t,i)=>{"use strict";const s=i(15503),a=i(81591),l=i(5308),n=i(40494),r=i(31644);i(26585);let o=(0,s.initializeApp)({apiKey:"AIzaSyA0fbv2VqE-AfF6V_nxSSXCEqaTlBlZnTI",authDomain:"sandbox-ce2c5.firebaseapp.com",databaseURL:"https://sandbox-ce2c5.firebaseio.com",projectId:"sandbox-ce2c5",storageBucket:"sandbox-ce2c5.appspot.com",messagingSenderId:"1003719887944"});const d=i(66329),c=i(86014),h=(0,n.getAuth)(o),m=new n.GoogleAuthProvider;m.addScope("https://www.googleapis.com/auth/contacts.readonly"),(0,n.getRedirectResult)(h).then((e=>{e?console.log("Sign-In Redirect Result, USER:",e.user.email,"is signed in"):h.currentUser?console.log("Sign-In Redirect Result, USER:","is signed in"):(0,n.signInWithRedirect)(h,m)}));const u=(0,r.getFunctions)(o),p=(0,a.getFirestore)(o),y=(0,l.getStorage)(o),g=(0,l.ref)(y),f=(0,l.ref)(g,"mkturkfiles");let v=!0,b=new d.Mkquery,k=new c.Mkfinder;(0,r.httpsCallable)(u,"bqListDatasets")().then((e=>{let t=document.querySelector("#bigquery-optgroup");e.data.forEach((e=>{let i=document.createElement("option");i.value=e,i.textContent="bq/"+e,t.appendChild(i)}))}));let D=document.querySelector("#rfid-switch"),S=document.querySelector("#qry-loc-selector"),w=document.querySelector("#field-selector"),x=document.querySelector("#quick-link-home"),E=document.querySelector("#quick-link-params"),A=document.querySelector("#quick-link-paramstorage"),I=document.querySelector("#quick-link-sceneparams"),T=document.querySelector("#quick-link-dailydata"),C=document.querySelector("#quick-link-marmosets");window.addEventListener("load",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles(f)})),C.addEventListener("click",(e=>{e.preventDefault(),S.value="marmosets",w.value="name",S.dispatchEvent(new Event("change")),w.dispatchEvent(new Event("change")),b.decodeQuery((0,a.collection)(p,"marmosets")).then((e=>{k.listFirestoreDocs(e,"marmosets")}))})),E.addEventListener("click",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles((0,l.ref)(g,"mkturkfiles/parameterfiles/subjects"))})),A.addEventListener("click",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles((0,l.ref)(g,"mkturkfiles/parameterfiles/params_storage"))})),x.addEventListener("click",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles(f)})),I.addEventListener("click",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles((0,l.ref)(f,"scenebags/objectome3d"))})),T.addEventListener("click",(e=>{e.preventDefault(),v=!1,S.value="mkturkfiles",S.dispatchEvent(new Event("change")),k.listStorageFiles((0,l.ref)(f,"mkdailydata"))})),S.addEventListener("change",(e=>{let t,i=document.querySelector("#field-selector"),s=document.querySelector("#keyword-input-0"),l=document.querySelector("#keyword-input-1"),n=document.querySelector("#keyword-input-2"),r=document.querySelector("#go-btn"),o=document.querySelector("#quick-plot-x"),d=document.querySelector("#quick-plot-y"),c=document.querySelector("#plot-btn");switch(S.value){case"marmosets":i.style.visibility="visible",s.style.visibility="visible",l.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="visible",B(),P("field-options");let e=document.createElement("option");e.setAttribute("class","field-options"),e.setAttribute("value","name"),e.setAttribute("selected","true"),e.textContent="name";let h=document.createElement("option");h.setAttribute("class","field-options"),h.setAttribute("value","sex"),h.textContent="sex";let m=document.createElement("option");m.setAttribute("class","field-options"),m.setAttribute("value","rfid"),m.textContent="RFID";let u=document.createElement("option");u.setAttribute("class","field-options"),u.setAttribute("value","breeding"),u.textContent="breeding";let y=document.createElement("option");y.setAttribute("class","field-options"),y.setAttribute("value","birthdate"),y.textContent="birthdate";let g=document.querySelector("#field-selector");g.appendChild(e),g.appendChild(h),g.appendChild(m),g.appendChild(u),g.appendChild(y),g.dispatchEvent(new Event("change"));break;case"mkturkdata":i.style.visibility="visible",s.style.visibility="visible",l.style.visibility="visible",n.style.visibility="hidden",r.style.visibility="visible",o.style.visibility="hidden",d.style.visibility="hidden",c.style.visibility="hidden",B(),P("field-options");let D=document.createElement("option");D.setAttribute("class","field-options"),D.setAttribute("value","agentTypeCurDate"),D.setAttribute("selected","true"),D.textContent="Agent & CurrentDate";let S=document.querySelector("#field-selector");S.appendChild(D),S.dispatchEvent(new Event("change"));break;case"objects":i.style.visibility="visible",s.style.visibility="visible",l.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="visible",o.style.visibility="hidden",d.style.visibility="hidden",c.style.visibility="hidden",B(),P("field-options");let w=document.createElement("option");w.setAttribute("class","field-options"),w.setAttribute("value","identity"),w.setAttribute("selected","true"),w.textContent="identity";let x=document.createElement("option");x.setAttribute("class","field-options"),x.setAttribute("value","mesh"),x.textContent="mesh";let E=document.createElement("option");E.setAttribute("class","field-options"),E.setAttribute("value","noun"),E.textContent="noun";let A=document.querySelector("#field-selector");A.appendChild(w),A.appendChild(x),A.appendChild(E),A.dispatchEvent(new Event("change"));break;case"mkdailydata":b.decodeQuery((0,a.collection)(p,"mkdailydata")).then((e=>{k.listFirestoreDocs(e,"mkdailydata")}));break;case"mkturkfiles":i.style.visibility="hidden",s.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="hidden",o.style.visibility="hidden",d.style.visibility="hidden",c.style.visibility="hidden",P("field-options"),v&&k.listStorageFiles(f);break;case"devices":i.style.visibility="hidden",s.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="hidden",o.style.visibility="hidden",d.style.visibility="hidden",c.style.visibility="hidden",B(),P("field-options"),t=b.decodeQuery((0,a.collection)(p,"devices")),t.then((e=>{k.listFirestoreDocs(e,"devices")}));break;case"eyecalibrations":console.log("eye"),i.style.visibility="hidden",s.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="hidden",o.style.visibility="hidden",d.style.visibility="hidden",c.style.visibility="hidden",B(),P("field-options"),t=b.decodeQuery((0,a.collection)(p,"eyecalibrations")),t.then((e=>{k.listFirestoreDocs(e,"eyecalibrations")}));break;case"mkscale":i.style.visibility="visible",s.style.visibility="visible",l.style.visibility="visible",n.style.visibility="hidden",r.style.visibility="visible",o.style.visibility="visible",d.style.visibility="visible",c.style.visibility="visible",B(),P("field-options");let I=document.createElement("option");I.setAttribute("class","field-options"),I.setAttribute("value","nameCurDate"),I.setAttribute("selected","true"),I.textContent="Name & CurrentDate",i.appendChild(I),i.dispatchEvent(new Event("change"));break;case"eyedata":i.style.visibility="visible",s.style.visibility="visible",l.style.visibility="visible",n.style.visibility="hidden",r.style.visibility="visible",o.style.visibility="visible",d.style.visibility="visible",c.style.visibility="visible",B(),P("field-options");let T=document.createElement("option");T.setAttribute("class","field-options"),T.setAttribute("value","nameCurDate"),T.setAttribute("selected","true"),T.textContent="Name & CurrentDate",i.appendChild(T),i.dispatchEvent(new Event("change"))}})),null==w||w.addEventListener("change",(e=>{let t=null==w?void 0:w.value,i=document.querySelector("#keyword-input-0"),s=document.querySelector("#keyword-input-1"),a=(document.querySelector("#keyword-input-2"),document.querySelector("#quick-plot-x")),l=document.querySelector("#quick-plot-y"),n=document.querySelector("#plot-btn");switch(t){case"name":B(),i.setAttribute("placeholder","name"),a.style.visibility="visible",l.style.visibility="visible",n.style.visibility="visible";break;case"sex":B(),i.setAttribute("placeholder","sex"),a.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden";break;case"rfid":B(),i.setAttribute("placeholder","RFID"),a.style.visibility="visible",l.style.visibility="visible",n.style.visibility="visible";break;case"breeding":B(),i.setAttribute("placeholder","breeding"),a.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden";break;case"birthdate":B(),i.setAttribute("placeholder","birthdate (e.g. 04/17/2019; +-7)"),a.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden";break;case"agentTypeCurDate":i.setAttribute("placeholder","Agent"),s.setAttribute("placeholder","CurrentDate (e.g. 04/17/2019; +-7)"),a.style.visibility="hidden",l.style.visibility="hidden",n.style.visibility="hidden";break;case"nameCurDate":i.setAttribute("placeholder","Name"),s.setAttribute("placeholder","CurrentDate (e.g. 04/17/2019; +-7)");break;case"eyedata":i.setAttribute("placeholder","Agent"),s.setAttribute("Placeholder","Date (e.g. 04/17/2019)")}}));let F=document.querySelector("#mkquery-form");function B(){let e=[...document.querySelectorAll(".keyword-input")];for(let t=0;t<e.length;t++)e[t].placeholder="",e[t].value=""}function P(e){var t;let i=document.getElementsByClassName(e);for(;i.length>0;)null===(t=i[0].parentNode)||void 0===t||t.removeChild(i[0])}null==F||F.addEventListener("submit",(async e=>{var t,i,s;e.preventDefault(),console.log("test weird");let l,n=null==S?void 0:S.value,r=null==w?void 0:w.value,o=null===(t=document.querySelector("#keyword-input-0"))||void 0===t?void 0:t.value,d=null===(i=document.querySelector("#keyword-input-1"))||void 0===i?void 0:i.value,c=(null===(s=document.querySelector("#keyword-input-2"))||void 0===s||s.value,[]),h="";switch(n){case"marmosets":o?c.push({field:r,keyword:o}):(console.error("No query arguments!"),alert("No query arguments!")),l=(0,a.query)((0,a.collection)(p,"marmosets"),(0,a.where)(c[0].field,"==",c[0].keyword)),h=`query(collection(db, 'marmosets'), ${b.mkquery(c)})`;break;case"mkturkdata":o&&c.push({field:"Agent",keyword:o}),d&&c.push({field:"CurrentDate",keyword:d}),0==c.length?(console.error("No query arguments!"),alert("No query arguments!")):1==c.length?l=(0,a.query)((0,a.collection)(p,"mkturkdata"),(0,a.where)(c[0].field,"==",c[0].keyword)):2==c.length?l=(0,a.query)((0,a.collection)(p,"mkturkdata"),(0,a.where)(c[0].field,"==",c[0].keyword),(0,a.where)(c[1].field,"==",c[1].keyword)):3==c.length&&(l=(0,a.query)((0,a.collection)(p,"mkturkdata"),(0,a.where)(c[0].field,"==",c[0].keyword),(0,a.where)(c[1].field,"==",c[1].keyword),(0,a.where)(c[2].field,"==",c[2].keyword))),c.length>0?h="db.collection('mkturkdata')"+b.mkquery(c):(console.error("No query arguments!"),alert("No query arguments!"));break;case"objects":o?c.push({field:r,keyword:o}):(console.error("No query arguments!"),alert("No query arguments!")),h="db.collection('objects')"+b.mkquery(c);break;case"mkscale":o&&c.push({field:"Name",keyword:o}),d&&c.push({field:"CurrentDate",keyword:d}),c.length>0?h="db.collection('mkscale')"+b.mkquery(c):(console.error("No query arguments!"),alert("No query arguments!"));break;case"eyedata":o&&d?h=b.mkbquery("eyedata",o,d):(console.error("Incorrect query: Need two query arguments!"),alert("Incorrect query: Need two query arguments!"))}if(h.startsWith("query")){console.log(h),b.decodeQuery(l).then((e=>{k.listFirestoreDocs(e,n),D.checked&&(k.finder.selectRow(),k.mke.displayFirebaseTextFile(k.finder.getData()[0],"marmosets"))}))}else if(h.startsWith("SELECT *")){let e=b.decodeBigQuery(h);console.log(e),e.then((e=>{Array.isArray(e.data)&&k.listBigQueryTable(e.data,n,o)}))}}))},86014:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mkfinder=void 0;const s=i(70655),a=i(15503),l=i(81591),n=i(7671),r=(0,s.__importDefault)(i(93162)),o=i(5308);(0,l.getFirestore)();t.Mkfinder=class{constructor(){this.finder=new Tabulator("#finder"),this.previousPath="",this.storage=(0,o.getStorage)((0,a.getApp)()),this.storageRef=(0,o.ref)(this.storage),this.selectedImages=[],this.backBtn=document.querySelector("#back-btn"),this.showImagesBtn=document.querySelector("#show-images-btn"),this.numImgSlider=document.querySelector("#num-image-slider"),this.downloadBtn=document.querySelector("#download-file"),this.pathName=document.querySelector("#path-name-span"),this.backBtnAction(),this.showImagesBtnAction(),this.numImgSliderAction(),this.downloadBtnAction(),this.refreshStorageTable(),this.mkt=new n.Mkthree,this.mki=new n.Mkimage,this.mke=new n.Mkeditor,this.mkc=new n.Mkchart}listFirestoreDocs(e,t){this.displayFirestoreTable(e,t)}displayFirestoreTable(e,t){e=this.timestampToDate(e),this.mke.makeActiveBtn.style.display="none",this.mke.storeParamBtn.style.display="none","marmosets"==t?(this.finder.destroy(),this.pathName.innerText="marmosets",this.finder=new Tabulator("#finder",{data:e,index:"name",layout:"fitColumns",initialSort:[{column:"name",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Name",field:"name"},{title:"Sex",field:"sex"},{title:"DOB",field:"birthdate"},{title:"RFID",field:"rfid"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t),this.mkc.removeElementsByClassName("axis-options"),this.mkc.populateAxisFields(i.getData())},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t),this.mkc.removeElementsByClassName("axis-options"),this.mkc.populateAxisFields(i.getData())},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"mkturkdata"==t?(this.finder.destroy(),this.pathName.innerText="mkturkdata",this.finder=new Tabulator("#finder",{data:e,index:"index",layout:"fitColumns",initialSort:[{column:"Agent",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Agent",field:"Agent"},{title:"Doctype",field:"Doctype"},{title:"CurrentDate",field:"CurrentDate"},{title:"FirestoreDocRoot",field:"FirestoreDocRoot",visible:!1}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"mkdailydata"==t?(this.finder.destroy(),this.pathName.innerText="mkdailydata",this.finder=new Tabulator("#finder",{data:e,index:"index",layout:"fitColumns",initialSort:[{column:"agent",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Agent",field:"agent"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"objects"==t?(this.finder.destroy(),this.pathName.innerText="objects",this.finder=new Tabulator("#finder",{data:e,index:"docname",layout:"fitColumns",initialSort:[{column:"identity",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Identity",field:"identity"},{title:"Mesh",field:"mesh"},{title:"Noun",field:"noun"},{title:"Meshfile",field:"meshfile"},{title:"MeshfilePath",field:"meshfilepath"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"devices"==t?(this.finder.destroy(),this.pathName.innerText="devices",this.finder=new Tabulator("#finder",{data:e,index:"docname",layout:"fitColumns",initialSort:[{column:"model",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Model",field:"model"},{title:"Brand",field:"brand"},{title:"Type",field:"type"},{title:"PPI",field:"ppi"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"eyecalibrations"==t?(this.finder.destroy(),this.pathName.innerText="eyecalibrations",this.finder=new Tabulator("#finder",{data:e,index:"Taskdoc",layout:"fitColumns",initialSort:[{column:"Agent",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Agent",field:"Agent"},{title:"CurrentDate",field:"CurrentDate"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):"mkscale"==t?(this.finder.destroy(),this.pathName.innerText="mkscale",this.finder=new Tabulator("#finder",{data:e,index:"Docname",layout:"fitColumns",initialSort:[{column:"CurrentDate",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Name",field:"Name"},{title:"CurrentDate",field:"CurrentDate"}],selectable:!0,selectableRangeMode:"click",rowClick:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t),this.mkc.populateAxisFields(i.getData())},rowTap:(e,i)=>{e.stopPropagation(),this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1",this.mke.displayFirebaseTextFile(i.getData(),t),this.mkc.populateAxisFields(i.getData())},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})):console.error("Wrong or Invalid database trying to be tabularized")}timestampToDate(e){function t(e,t,i){try{i[t]=e.toDate().toJSON()}catch{}}return console.time("Timestamp Conversion"),e.forEach((e=>{for(let i of Object.keys(e))if(Array.isArray(e[i]))e[i].forEach(t);else if(this.isDict(e[i])){try{e[i]=e[i].toDate().toJSON();continue}catch(e){}for(let t of Object.keys(e[i]))try{e[i][t]=e[i][t].toDate().toJSON()}catch{}}else if(!this.isString(e[i])&&!this.isNumber(e[i]))try{e[i]=e[i].toDate().toJSON()}catch{}})),console.timeEnd("Timestamp Conversion"),e}isDict(e){return e&&"object"==typeof e&&e.constructor===Object}isString(e){return"string"==typeof e||e.constructor===String}isNumber(e){return"number"==typeof e&&isFinite(e)}async listStorageFiles(e){function t(e){let t=1e3;if(Math.abs(e)<t)return e+" B";let i=["kB","MB","GB","TB"],s=-1;do{e/=t,++s}while(Math.abs(e)>=t&&s<i.length-1);return e.toFixed(1)+" "+i[s]}this.backBtn.disabled="mkturkfiles"==e.fullPath,"mkturkfiles/parameterfiles/params_storage"==e.fullPath?(this.mke.storeParamBtn.style.display="none",this.mke.paramGenBtnBox.style.display="none",this.mke.svSceneBtn.style.display="none",this.mke.makeActiveBtn.style.display="inline-block",this.mke.updateBtn.style.display="inline-block",this.mke.btnBoxDiv.style.gridTemplateAreas='"update-btn active-btn"'):"mkturkfiles/parameterfiles/subjects"==e.fullPath?(this.mke.makeActiveBtn.style.display="none",this.mke.paramGenBtnBox.style.display="none",this.mke.svSceneBtn.style.display="none",this.mke.updateBtn.style.display="inline-block",this.mke.storeParamBtn.style.display="inline-block",this.mke.btnBoxDiv.style.gridTemplateAreas='"update-btn store-param-btn"'):"mkturkfiles/scenebags/objectome3d/templates"==e.fullPath?(this.mke.makeActiveBtn.style.display="none",this.mke.storeParamBtn.style.display="none",this.mke.svSceneBtn.style.display="none",this.mke.paramGenBtnBox.style.display="inline-block",this.mke.updateBtn.style.display="inline-block",this.mke.btnBoxDiv.style.gridTemplateAreas='"param-gen-btn-box update-btn"'):(this.mke.makeActiveBtn.style.display="none",this.mke.storeParamBtn.style.display="none",this.mke.paramGenBtnBox.style.display="none",this.mke.svSceneBtn.style.display="none",this.mke.updateBtn.style.display="inline-block",this.mke.btnBoxDiv.style.gridTemplateAreas='"update-btn update-btn"'),this.pathName.innerText=e.fullPath;let i,s=e.fullPath.split("/"),a=new Array,l=await(0,o.listAll)(e);this.previousPath="";for(let e=0;e<s.length-1;e++)this.previousPath+=s[e]+"/";l.prefixes.forEach((e=>{a.push({name:e.name,contentType:"folder",fullPath:e.fullPath,size:"N/A"})})),i=l.items.map((async function(e){await(0,o.getMetadata)(e).then((e=>{a.push({name:e.name,contentType:e.contentType,fullPath:e.fullPath,size:t(e.size),timeCreated:e.timeCreated})}))})),await Promise.all(i),this.displayStorageTable(a)}refreshStorageTable(){document.addEventListener("storageFileChanged",(e=>{let t=this.mke.getActiveFile().id;this.listStorageFiles(t.parent)}))}displayStorageTable(e){this.finder.destroy(),this.finder=new Tabulator("#finder",{data:e,index:"name",responsiveLayout:!0,layout:"fitColumns",resizableColumns:!0,initialSort:[{column:"name",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Name",field:"name",widthGrow:3},{title:"Type",field:"contentType"},{title:"Path",field:"fullPath"},{title:"Size",field:"size"}],selectable:!0,selectableRangeMode:"click",rowDblClick:(e,t)=>{e.preventDefault(),e.stopPropagation(),"folder"===t.getData().contentType&&(console.log("rowDblClick",t.getData().fullPath),this.listStorageFiles((0,o.ref)(this.storageRef,t.getData().fullPath)))},rowDblTap:(e,t)=>{e.preventDefault(),e.stopPropagation(),"folder"===t.getData().contentType&&(console.log(t.getData().fullPath),this.listStorageFiles((0,o.ref)(this.storageRef,t.getData().fullPath)))},rowClick:async(e,t)=>{if(e.stopPropagation(),"folder"===t.getData().contentType)console.log("rowClick",t.getData().fullPath);else if(t.getData().contentType.includes("text")||t.getData().contentType.includes("json")){this.mkt.destroy(),this.mki.removeImages(),this.mke.editorDivElement.style.zIndex="3",this.mki.imgCanvasDiv.style.zIndex="2",this.mkt.canvas.style.zIndex="1";let e=(0,o.ref)(this.storageRef,t.getData().fullPath);this.mke.displayStorageTextFile(e)}else if(t.getData().contentType.includes("image")){this.mkt.destroy(),this.mki.removeImages(),this.mki.imgCanvasDiv.style.zIndex="3",this.mke.editorDivElement.style.zIndex="2",this.mkt.canvas.style.zIndex="1";let e=(0,o.ref)(this.storageRef,t.getData().fullPath),i=t.getData().name;this.mki.displayImage(e,i)}else if("application/octet-stream"===t.getData().contentType&&t.getData().name.includes(".glb")){this.mkt.destroy(),this.mki.removeImages(),this.mkt.canvas.style.zIndex="3",this.mke.editorDivElement.style.zIndex="2",this.mki.imgCanvasDiv.style.zIndex="1";let e=(0,o.ref)(this.storageRef,t.getData().fullPath);this.mkt.displayMesh(e)}},rowSelectionChanged:(e,t)=>{this.showImagesBtn.disabled=!this.imageTypeTest(e),this.imageTypeTest(e)&&(this.selectedImages=e)},tableBuilt:()=>{let e=document.querySelector("#select-all");e.addEventListener("change",(t=>{1==e.checked?this.finder.selectRow():this.finder.deselectRow()}))}})}listBigQueryTable(e,t,i){this.displayBigqueryTable(e),this.pathName.innerText=`${t}.${i}`}displayBigqueryTable(e){this.finder.destroy(),this.finder=new Tabulator("#finder",{data:e,index:"timestamp.value",responsiveLayout:!0,layout:"fitColumns",resizableColumns:!0,initialSort:[{column:"timestamp.value",dir:"asc"}],columns:[{title:"<input id='select-all' type='checkbox'/>",width:15,headerSort:!1},{title:"Timestamp",field:"timestamp.value"}],selectable:!0,selectableRangeMode:"click",rowClick:async(e,t)=>{e.stopPropagation(),this.mke.displayBigQueryTableRow(t.getData())},rowTap:(e,t)=>{e.stopPropagation(),this.mke.displayBigQueryTableRow(t.getData())},dataLoaded:e=>{console.log("table data",e),this.mkc.removeElementsByClassName("axis-options"),this.mkc.bqPopulateAxisFields(e,"eyedata")}})}backBtnAction(){this.backBtn.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.log("[backBtn Pressed]: previousPath:",this.previousPath),this.listStorageFiles((0,o.ref)(this.storageRef,this.previousPath))}))}numImgSliderAction(){this.numImgSlider.addEventListener("change",(e=>{console.log(this.numImgSlider.value),this.mki.imgCanvas.style.gridTemplateColumns="repeat("+String(this.numImgSlider.value)+", minmax(0,1fr))"}))}showImagesBtnAction(){this.showImagesBtn.addEventListener("click",(async e=>{this.mkt.destroy(),this.mki.removeImages(),this.mki.imgCanvasDiv.style.zIndex="3",this.mke.editorDivElement.style.zIndex="2",this.mkt.canvas.style.zIndex="1";for(let e=0;e<this.selectedImages.length;e++){let t=(0,o.ref)(this.storageRef,this.selectedImages[e].fullPath),i=this.selectedImages[e].name;await this.mki.displayImage(t,i)}}))}imageTypeTest(e){if(0==e.length||1==e.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].contentType.includes("image"))return!1;return!0}downloadBtnAction(){this.downloadBtn.addEventListener("click",(async e=>{let t=this.finder.getSelectedRows(),i=document.querySelector("#qry-loc-selector");if("mkturkfiles"!=i.value||t[0].getData().contentType.includes("folder")){if("marmosets"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.name+".json")}else if("mkdailydata"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.agent+".json")}else if("mkturkdata"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData().FirestoreDocRoot+"_"+t[e].getData().Doctype,s=t[e].getData(),a=new Blob([JSON.stringify(s,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(a,i+".json")}else if("devices"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.docname+".json")}else if("eyecalibration"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.Docname+".json")}else if("mkscale"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.Docname+".json")}else if("objects"==i.value)for(let e=0;e<t.length;e++){let i=t[e].getData(),s=new Blob([JSON.stringify(i,null,1)],{type:"application/json; charset=utf-8"});r.default.saveAs(s,i.docname+".json")}}else for(let e=0;e<t.length;e++)(0,o.getDownloadURL)((0,o.ref)(this.storageRef,t[e].getData().fullPath)).then((async i=>{let s=await(await fetch(i)).blob();r.default.saveAs(s,t[e].getData().name)}))}))}}},7671:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mkchart=t.Mkimage=t.Mkthree=t.Mkeditor=void 0;const s=i(70655),a=i(15503),l=i(81591),n=i(5308),r=(0,s.__importDefault)(i(13807)),o=(0,s.__importDefault)(i(11949)),d=(0,s.__importStar)(i(56772)),c=(0,s.__importStar)(i(2212)),h=i(69365),m=i(1217),u=i(80215),p=(0,l.getFirestore)((0,a.getApp)()),y=(0,n.getStorage)((0,a.getApp)());t.Mkeditor=class{constructor(){this.editorDivElement=document.querySelector("#editor-div"),this.editorElement=document.querySelector("#editor"),this.editor=new r.default(this.editorElement),this.updateBtn=document.querySelector("#update-btn"),this.btnBoxDiv=document.querySelector("#button-box"),this.paramGenBtnBox=document.querySelector("#param-gen-btn-box"),this.makeActiveBtn=document.querySelector("#active-btn"),this.storeParamBtn=document.querySelector("#store-param-btn"),this.activeFile={loc:"",id:""},this.updateBtnAction(),this.makeActiveBtnAction(),this.storeParamBtnAction(),this.fileNameInput=document.querySelector("#file-name-input"),this.fileRenameBtn=document.querySelector("#file-rename-btn"),this.fileDupBtn=document.querySelector("#file-dup-btn"),this.fileDupModal=document.querySelector("#file-dup-modal"),this.renameBtnAction(),this.renameTextFieldAction(),this.getActiveFile(),this.fileDupBtnAction(),this.genBtn=document.querySelector("#generate-btn"),this.expandBtn=document.querySelector("#expand-btn"),this.svSceneBtn=document.querySelector("#save-scene-param-btn"),this.genBtnAction(),this.svSceneBtnAction(),this.pe=new u.ParseEngine,this.userEditedSceneParam={},this.generatedSceneParam={}}getActiveFile(){return this.activeFile}displayFirebaseTextFile(e,t){this.fileRenameBtn.style.display="none",this.fileDupBtn.style.display="none",this.storeParamBtn.style.display="none",this.updateBtn.style.display="inline-block",this.btnBoxDiv.style.gridTemplateAreas='"update-btn update-btn"',this.fileNameInput.value="",this.fileNameInput.disabled=!0;try{let i={modes:["tree","code"],sortObjectKeys:!0};this.editor.destroy(),this.editor=new r.default(this.editorElement,i,e),this.trackFirebaseActiveFile(t,e)}catch(e){console.error("JSONEditor Error:",e)}}displayBigQueryTableRow(e){this.btnBoxDiv.style.display="none";try{this.editor.destroy();let t={modes:["tree","code"]};this.editor=new r.default(this.editorElement,t,e),this.fileNameInput.placeholder=e.timestamp.value}catch(e){console.error("JSONEditor Error:",e)}}trackFirebaseActiveFile(e,t){"marmosets"===e?(this.activeFile={loc:e,id:t.name},this.fileNameInput.placeholder=String(this.activeFile.id)):"mkturkdata"===e?"task"===t.Doctype?(this.activeFile={loc:e,id:t.Taskdoc},this.fileNameInput.placeholder=String(this.activeFile.id)):"images"===t.Doctype&&(this.activeFile={loc:e,id:t.Imagesdoc},this.fileNameInput.placeholder=String(this.activeFile.id)):"mkdailydata"===e?(this.activeFile={loc:e,id:t.agent},this.fileNameInput.placeholder=String(this.activeFile.id)):"objects"===e?(this.activeFile={loc:e,id:t.docname},this.fileNameInput.placeholder=String(this.activeFile.id)):"eyecalibrations"===e?(this.activeFile={loc:e,id:t.Docname},this.fileNameInput.placeholder=String(this.activeFile.id)):"devices"===e?(this.activeFile={loc:e,id:t.docname},this.fileNameInput.placeholder=String(this.activeFile.id)):"mkscale"===e&&(this.activeFile={loc:e,id:t.Docname},this.fileNameInput.placeholder=String(this.activeFile.id)),console.log("activeFile",this.activeFile)}async displayStorageTextFile(e){console.log("diplayStorageTextFile FILEREF",e),this.fileNameInput.disabled=!1,this.fileRenameBtn.style.display="inline-block",this.fileNameInput.value="";let t={modes:["tree","code"],templates:[{text:"Camera",title:"Insert a Camera node",field:"CameraTemplate",value:{type:"PerspectiveCamera",fieldOfView:45,near:.1,far:2e3,position:{x:[0],y:[0],z:[0]},targetInches:{x:[0],y:[0],z:[0]},visible:[1]}},{text:"Light",title:"Insert a Light node",field:"LightTemplate",value:{type:"DirectionalLight",color:"0xffffff",intensity:[5],position:{x:[0],y:[0],z:[0]},visible:[1]}},{text:"Object",title:"Insert an Object node",field:"ObjectTemplate",value:{meshpath:"",objectdoc:"",sizeInches:[.5],positionInches:{x:[0],y:[0],z:[0]},rotationDegrees:{x:[0],y:[0],z:[0]},material:{type:"MeshPhysicalMaterial",color:"#7F7F7F",metalness:.25,roughness:.65,reflectivity:.5,opacity:[1],transparent:!1},visible:[1],morphTarget:[]}},{text:"Background",title:"Insert a Background node",field:"ImagesTemplate",value:{imagebag:"",imageidx:[]}}]},i={modes:["tree","code"]},s={modes:["tree","code"],onClassName:function(e){return console.log(`onClassName path=${e.path}, field=${e.field}, value=${e.value}`),["Agent","CheckRFID"].includes(e.field)?"color-node-bio":["Automator","AutomatorFilePath","CurrentAutomatorStage","MinPercentCriterion","MinTrialsCriterion"].includes(e.field)?"color-node-automator":["DragtoRespond","CalibrateEye","NRSVP","NRSVPMax","SameDifferent","SamplingStrategy","NStickyResponse","NTrialsPerBagBlock"].includes(e.field)?"color-node-general":["NGridPoints","GridSpacingInches","GridXOffsetInches","GridYOffsetInches","FixationGridIndex","SampleGridIndex","ObjectGridIndex","ChoiceGridIndex","TestGridIndex"].includes(e.field)?"color-node-grid":["NFixations","FixationUsesSample","FixationSizeInches","FixationDuration","FixationTimeOut"].includes(e.field)?"color-node-fixation":["FixationWindowSizeInches","FixationDotSizeInches"].includes(e.field)?"color-node-fixation-config":["ImageBagsSample","KeepSampleON","SamplePRE","SampleOFF"].includes(e.field)?"color-node-sample":["ImageBagsTest","KeepTestON","TestOFF","HideTestDistractors"].includes(e.field)?"color-node-test":["ChoiceSizeInches","HideChoiceDistractors","ChoiceTimeOut"].includes(e.field)?"color-node-choice":["RewardStage","RewardPer1000Trials","NRewardMax","NConsecutiveHitsforBonus","PunishTimeOut","ConsecutiveHitsITI"].includes(e.field)?"color-node-reward":"color-node-nuisance"},schema:d.taskParamSchema},a=await(0,n.getDownloadURL)(e).then((async e=>{let t=await fetch(e);return await t.json()})).catch((e=>{console.error("Error getting download URL:",e)}));if(e.fullPath.includes("mkturkfiles/scenebags/objectome3d"))e.fullPath.includes("template")?(this.fileDupBtn.style.display="inline-block",i=t):this.fileDupBtn.style.display="inline-block";else if(e.fullPath.includes("mkturkfiles/parameterfiles")){console.log("FILEEEE:",a),this.fileDupBtn.style.display="inline-block";let e=Object.keys(JSON.parse(JSON.stringify(d.taskParamSchema,null,1)).properties);if(Array.isArray(a)){for(let t in a){let i=JSON.parse(JSON.stringify(a[t],e,1)),s={};Object.keys(a[t]).forEach((e=>{e in i||(s[e]=a[t][e])})),a[t]=Object.assign(i,s),console.log("json:",i,"json2:",s)}console.log("FILE AFTER PROCESSING:",a)}else{let t=JSON.parse(JSON.stringify(a,e,1)),i={};Object.keys(a).forEach((e=>{e in t||(i[e]=a[e])})),console.log("json:",t,"json2:",i),a=Object.assign(t,i)}i=s}else this.fileDupBtn.style.display="none";this.editor.destroy(),this.editor=new r.default(this.editorElement,i,a),this.activeFile={loc:"mkturkfiles",id:e},console.log("activeFile",this.activeFile),this.fileNameInput.placeholder=e.name}fileDupBtnAction(){var e,t;let i=this.fileDupModal.querySelector("#dup-file-name");this.fileDupBtn.addEventListener("click",(e=>{e.preventDefault(),this.fileDupModal,this.fileDupModal.showModal();let t=this.activeFile.id;i.value="Copy of "+t.name,i.focus(),i.select()})),null===(e=this.fileDupModal.querySelector(".close"))||void 0===e||e.addEventListener("click",(()=>{this.fileDupModal.close()})),null===(t=this.fileDupModal.querySelector(".save"))||void 0===t||t.addEventListener("click",(()=>{let e=this.activeFile.id,t=(0,n.ref)(e.parent,i.value),s=new Blob([JSON.stringify(this.editor.get(),null,1)]);(0,n.uploadBytes)(t,s,{contentType:"application/json"}).then((async e=>{console.log("[DOCUMENT DUPLICATED]:",e),alert("Document Duplicated");let i=new Event("storageFileChanged");this.fileNameInput.value="",this.displayStorageTextFile(t),document.dispatchEvent(i)})).catch((i=>{console.error("[DOCUMENT DUPLICATE FAILED]:",i),console.error("srcFile:",e,"destFile:",t),alert("Document Duplication Failed")})),this.fileDupModal.close()}))}generateSceneParamModalAction(){let e=document.getElementsByClassName("collapsible");for(let t=0;t<e.length;t++){let i=e[t];i.addEventListener("click",(e=>{e.preventDefault(),i.classList.toggle("active");let t=i.nextElementSibling;"block"===t.style.display?t.style.display="none":t.style.display="block"}))}let t=new Tabulator("#size-inches-table",{data:[{sampling:"gaussian",params:"0, 1",n:5}],layout:"fitColumns",history:!0,columns:[{title:"Sampling",field:"sampling",editor:"select",editorParams:{values:["gaussian","uniform","range"]}},{title:"Params",field:"params",editor:"input",editable:!0},{title:"n || step size",field:"n",editor:"input",editable:!0}]}),i=document.querySelector(".size-inches"),s=i.querySelector(".add-rule-btn"),a=i.querySelector(".undo-edit-btn");s.addEventListener("click",(e=>{e.preventDefault(),t.addRow({sampling:"",params:"",n:NaN},!1)})),a.addEventListener("click",(e=>{t.undo()}));let l=new Tabulator("#position-inches-table",{data:[{target:"x",sampling:"gaussian",params:"0, 1",n:5}],layout:"fitColumns",history:!0,columns:[{title:"Target",field:"target",editor:"select",editorParams:{values:["x","y","z"]}},{title:"Sampling",field:"sampling",editor:"select",editorParams:{values:["gaussian","uniform","range"]}},{title:"Params",field:"params",editor:"input",editable:!0},{title:"n || step size",field:"n",editor:"input",editable:!0}]}),n=document.querySelector(".position-inches"),r=n.querySelector(".add-rule-btn"),o=n.querySelector(".undo-edit-btn");r.addEventListener("click",(e=>{e.preventDefault(),l.addRow({target:"",sampling:"",params:"",n:NaN})})),o.addEventListener("click",(e=>{l.undo()}));let d=new Tabulator("#rotation-degrees-table",{data:[{target:"x",sampling:"gaussian",params:"0, 1",n:5}],layout:"fitColumns",history:!0,columns:[{title:"Target",field:"target",editor:"select",editorParams:{values:["x","y","z"]}},{title:"Sampling",field:"sampling",editor:"select",editorParams:{values:["gaussian","uniform","range"]}},{title:"Params",field:"params",editor:"input",editable:!0},{title:"n || step size",field:"n",editor:"input",editable:!0}]}),c=document.querySelector(".rotation-degrees"),h=c.querySelector(".add-rule-btn"),m=c.querySelector(".undo-edit-btn");h.addEventListener("click",(e=>{e.preventDefault(),d.addRow({target:"",sampling:"",params:"",n:NaN})})),m.addEventListener("click",(e=>{d.undo()}))}renameTextFieldAction(){this.fileNameInput.addEventListener("click",(e=>{let t=this.activeFile.id.name;this.fileNameInput.value=t,this.fileNameInput.focus(),this.fileNameInput.select()}))}renameBtnAction(){this.fileRenameBtn.addEventListener("click",(e=>{if(this.fileNameInput.value){let e=this.activeFile.id,t=(0,n.ref)(e.parent,this.fileNameInput.value),i=new Blob([JSON.stringify(this.editor.get(),null,1)]),s={contentType:"application/json"};(0,n.uploadBytes)(t,i,s).then((async i=>{await(0,n.deleteObject)(e),console.log("[DOCUMENT RENAMED]:",i),alert("Document Renamed");let s=new Event("storageFileChanged");this.fileNameInput.value="",this.displayStorageTextFile(t),document.dispatchEvent(s)})).catch((i=>{console.error("[DOCUMENT RENAME FAILED]:",i),console.error("oldFile",e,"newFile",t),alert("Document Rename Failed")}))}else console.log("file name input field is null")}))}updateBtnAction(){this.updateBtn.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let t=this.activeFile.loc;if("marmosets"===t||"mkturkdata"===t||"devices"===t||"mkscale"===t||"eyecalibrations"===t||"mkdailydata"===t){let e=this.activeFile.id;(0,l.setDoc)((0,l.doc)(p,t,e),this.dateToTimestamp(this.editor.get())).then((()=>{console.log("[DOCUMENT UPDATED]:",e),alert("Document Updated")})).catch((t=>{console.error("[DOCUMENT UPDATE FAILED]","FILE:",e,"ERROR:",t),alert("Document Update Failed")}))}else if("mkturkfiles"===this.activeFile.loc){let e=this.activeFile.id,t=new Blob([JSON.stringify(this.editor.get(),null,1)]),i={contentType:"application/json"};(0,n.uploadBytes)(e,t,i).then((e=>{console.log(this.editor.get()),console.log("[DOCUMENT UPDATED]:",e.metadata.name),alert("Document Updated"),document.dispatchEvent(new Event("storageFileChanged"))})).catch((t=>{console.error("[DOCUMENT UPDATE FAILED]","FILE:",e,"ERROR:",t),alert("Document Update Failed")}))}else console.error("[DOCUMENT UPDATE FAILED] ERROR: Location Error")}))}makeActiveBtnAction(){this.makeActiveBtn.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.log(this.activeFile);let t=(0,n.ref)(y),i=this.editor.get(),s="mkturkfiles/parameterfiles/subjects/"+i.Agent+"_params.json",a=(0,n.ref)(t,s);i=new Blob([JSON.stringify(i,null,1)]);(0,n.uploadBytes)(a,i,{contentType:"application/json"}).then((e=>{console.log("[PARAM MADE ACTIVE]:",e.metadata.name),alert("Param Active")})).catch((e=>{console.error("[PARAM ACTIVATION FAILED]","FILE:",a,"ERROR",e),alert("Param Activation Failed")}))}))}storeParamBtnAction(){this.storeParamBtn.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.log(this.activeFile);let t=(0,n.ref)(y),i=this.editor.get(),s=new Date,a="mkturkfiles/parameterfiles/params_storage/"+i.Agent+"_params_"+s.toJSON().split("T")[0]+".json",l=(0,n.ref)(t,a);i=new Blob([JSON.stringify(i,null,1)]);(0,n.uploadBytes)(l,i,{contentType:"application/json"}).then((e=>{console.log("[PARAM STORED]:",e.metadata.name),alert("Param stored")})).catch((e=>{console.error("[PARAM STORAGE FAILED]","FILE:",l,"ERROR",e),alert("Param Storage Failed")}))}))}genBtnAction(){this.genBtn.addEventListener("click",(e=>{if("generate"==this.genBtn.value){this.userEditedSceneParam=this.editor.get(),this.generatedSceneParam=this.pe.generateParamObject(this.userEditedSceneParam,"vectorize"),this.editor.destroy();let e={modes:["tree","code"]};this.editor=new r.default(this.editorElement,e,this.generatedSceneParam),this.genBtn.value="revert",this.genBtn.textContent="Revert",this.updateBtn.style.display="none",this.svSceneBtn.style.display="inline-block",this.btnBoxDiv.style.gridTemplateAreas='"param-gen-btn-box sv-scene-param-btn"'}else if("revert"==this.genBtn.value){this.editor.destroy(),this.generatedSceneParam={};let e={modes:["tree","code"]};this.editor=new r.default(this.editorElement,e,this.userEditedSceneParam),this.genBtn.value="generate",this.genBtn.textContent="Vectorize Param",this.svSceneBtn.style.display="none",this.updateBtn.style.display="inline-block",this.btnBoxDiv.style.gridTemplateAreas='"param-gen-btn-box update-btn"'}})),this.expandBtn.addEventListener("click",(e=>{if("expand"==this.expandBtn.value){this.userEditedSceneParam=this.editor.get(),this.generatedSceneParam=this.pe.generateParamObject(this.userEditedSceneParam,"expand"),this.editor.destroy();let e={modes:["tree","code"]};this.editor=new r.default(this.editorElement,e,this.generatedSceneParam),this.expandBtn.value="revert",this.expandBtn.textContent="Revert",this.updateBtn.style.display="none",this.svSceneBtn.style.display="inline-block",this.btnBoxDiv.style.gridTemplateAreas='"param-gen-btn-box sv-scene-param-btn"'}else if("revert"==this.expandBtn.value){this.editor.destroy(),this.generatedSceneParam={};let e={modes:["tree","code"]};this.editor=new r.default(this.editorElement,e,this.userEditedSceneParam),this.expandBtn.value="expand",this.expandBtn.textContent="Expand Param",this.svSceneBtn.style.display="none",this.updateBtn.style.display="inline-block",this.btnBoxDiv.style.gridTemplateAreas='"param-gen-btn-box update-btn"'}}))}svSceneBtnAction(){var e,t;let i=document.querySelector("#filename-modal"),s=i.querySelector(".filename-input");this.svSceneBtn.addEventListener("click",(e=>{e.preventDefault(),i.showModal();let t=this.activeFile.id,a=new Date;s.value=a.toLocaleDateString("en-CA")+"_"+t.name,s.focus(),s.select()})),null===(e=i.querySelector(".cl"))||void 0===e||e.addEventListener("click",(()=>{i.close()})),null===(t=i.querySelector(".sv"))||void 0===t||t.addEventListener("click",(()=>{var e,t;let a=this.activeFile.id,l=(0,n.ref)(null===(e=a.parent)||void 0===e?void 0:e.parent,`generatedParams/${s.value}`),r=s.value.split(".")[0]+"_source."+s.value.split(".")[1],o=(0,n.ref)(null===(t=a.parent)||void 0===t?void 0:t.parent,`generatedParams/${r}`),d=new Blob([JSON.stringify(this.generatedSceneParam,null,1)]),c=new Blob([JSON.stringify(this.userEditedSceneParam,null,1)]),h={contentType:"application/json"};(0,n.uploadBytes)(l,d,h).then((e=>{alert("Generated param file was saved"),this.generatedSceneParam={},this.userEditedSceneParam={},this.displayStorageTextFile(a)})).catch((e=>{console.error("Param Generation Failed:",e),alert("Generated param file was NOT saved")})),(0,n.uploadBytes)(o,c,h),i.close()}))}dateToTimestamp(e){function t(e,t,i){let s=new Date(e);!isNaN(Number(s))&&s instanceof Date&&"string"==typeof e&&(i[t]=l.Timestamp.fromDate(s))}for(let i of Object.keys(e))if(Array.isArray(e[i])&&(i.toLowerCase().includes("time")||i.toLowerCase().includes("dates")))console.log("ARRAY data["+i+"]="+e[i]),e[i].forEach(t);else if(this.isDict(e[i]))for(let t of Object.keys(e[i])){let s=new Date(e[i][t]);!isNaN(Number(s))&&s instanceof Date&&this.isString(e[i][t])&&(console.log("Dictionary data["+i+"]="+e[i]),e[i][t]=l.Timestamp.fromDate(s))}else if(this.isString(e[i])&&(i.toLowerCase().includes("date")||i.toLowerCase().includes("time"))){let t=new Date(e[i]);!isNaN(Number(t))&&t instanceof Date&&(e[i]=l.Timestamp.fromDate(t))}return e}isDict(e){return e&&"object"==typeof e&&e.constructor===Object}isString(e){return"string"==typeof e||e.constructor===String}};t.Mkthree=class{constructor(){this.scene=null,this.camera=null,this.cameraPos=null,this.controls=null,this.dirLight=null,this.dirLightPos=null,this.light=null,this.loader=null,this.renderer=null,this.animationID=-1,this.active=!1,this.canvas=document.querySelector("#three-canvas");let e=document.querySelector("#editor-div");this.canvas.width=e.offsetWidth,this.canvas.height=e.offsetHeight,this.canvas.style.width=String(e.offsetWidth),this.canvas.style.height=String(e.offsetHeight),this.resizeCanvasAction()}async displayMesh(e){console.time("displayMesh()"),this.active&&this.destroy(),this.renderer=new c.WebGLRenderer({canvas:this.canvas,antialias:!0}),this.renderer.setClearColor(16777215),this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=c.LinearToneMapping,this.renderer.toneMappingExposure=10,this.renderer.outputEncoding=c.GammaEncoding,this.renderer.gammaFactor=2.2,this.cameraPos=new c.Vector3(0,0,10),this.camera=new c.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,2e3),this.camera.position.set(this.cameraPos.x,this.cameraPos.y,this.cameraPos.z),this.dirLightPos=new c.Vector3(0,2,0),this.dirLight=new c.DirectionalLight(16777215,.5),this.dirLight.position.set(this.dirLightPos.x,this.dirLightPos.y,this.dirLightPos.z),this.light=new c.AmbientLight(4210752,.05),this.controls=new h.OrbitControls(this.camera,this.renderer.domElement),this.controls.target=new c.Vector3(0,0,0),this.scene=new c.Scene,this.scene.add(this.camera),this.scene.add(this.dirLight),this.scene.add(this.light);let t=await this.loadMesh(e);this.scene.add(t.scene),requestAnimationFrame(this.animate.bind(this)),this.renderer.render(this.scene,this.camera),this.active=!0,console.timeEnd("displayMesh()")}async loadMesh(e){try{let t=await(0,n.getDownloadURL)(e).catch((e=>{console.error("Error:",e)}));return this.loader=new m.GLTFLoader,new Promise(((e,i)=>{var s;try{null===(s=this.loader)||void 0===s||s.load(t,(function(t){t.scene.traverse((e=>{if(e.material){let t=new c.MeshPhongMaterial({color:"#FFE0BD"});"morphTargetInfluences"in e&&(t.morphTargets=!0),e.material=t,e.material.needsUpdate=!0}})),e(t)}))}catch(e){console.error("Error:",e)}}))}catch(e){console.error("Error:",e)}}animate(){var e;this.animationID=requestAnimationFrame(this.animate.bind(this)),this.scene&&this.camera&&(null===(e=this.renderer)||void 0===e||e.render(this.scene,this.camera))}destroy(){var e;try{this.scene=null,this.camera=null,this.cameraPos=null,this.controls=null,this.dirLight=null,this.dirLightPos=null,this.light=null,this.loader=null,null===(e=this.renderer)||void 0===e||e.clear(),this.renderer=null,this.animationID=-1,this.active=!1,cancelAnimationFrame(this.animationID)}catch(e){console.error("Error destroying THREE Objects:",e)}}resizeCanvasAction(){window.addEventListener("resize",(e=>{let t=document.querySelector("#editor-div");this.canvas.width=t.offsetWidth,this.canvas.height=t.offsetHeight,this.canvas.style.width=String(t.offsetWidth),this.canvas.style.height=String(t.offsetHeight)}))}};t.Mkimage=class{constructor(){this.imgCanvasDiv=document.querySelector("#image-canvas-div"),this.imgCanvas=document.querySelector("#image-canvas"),this.imgGallery=new o.default(document.getElementById("image-canvas"))}async displayImage(e,t){let i=document.createElement("li");i.setAttribute("class","imageList");let s=document.createElement("div"),a=document.createElement("img"),l=document.createElement("p");l.innerHTML=t,await(0,n.getDownloadURL)(e).then((e=>{a.src=e})),s.appendChild(a),s.appendChild(l),i.appendChild(s),this.imgCanvas.appendChild(i),this.imgGallery.destroy(),this.imgGallery=new o.default(document.getElementById("image-canvas"))}removeImages(){var e;let t=document.getElementsByClassName("imageList");for(;t.length>0;)null===(e=t[0].parentNode)||void 0===e||e.removeChild(t[0])}};t.Mkchart=class{constructor(){google.charts.load("current",{packages:["corechart"]}),this.chartDiv=document.querySelector("#chart-div"),this.finderDiv=document.querySelector("#finder-div"),this.plotX=document.querySelector("#quick-plot-x"),this.plotY=document.querySelector("#quick-plot-y"),this.plotBtn=document.querySelector("#plot-btn"),this.isActive=!1,this.isBigQuery=!1,this.data=null,console.log(this.chartDiv),this.plotBtnAction()}plotBtnAction(){this.plotBtn.addEventListener("click",(e=>{if(e.preventDefault(),this.isActive=!this.isActive,0==this.isBigQuery)if(this.isActive){this.plotBtn.textContent="Close Quick Plot",this.chartDiv.style.zIndex="2",this.finderDiv.style.zIndex="1";let e=new google.visualization.DataTable;e.addColumn("datetime",this.plotX.value),e.addColumn("number",this.plotY.value);for(let t=0;t<this.data[this.plotX.value].length;t++)e.addRow([new Date(this.data[this.plotX.value][t]),parseFloat(this.data[this.plotY.value][t])]);console.log(this.chartDiv.clientWidth);let t=new google.visualization.LineChart(this.chartDiv),i={title:this.plotY.value,width:this.chartDiv.offsetWidth,height:this.chartDiv.offsetHeight,legend:"none",pointSize:10};t.draw(e,i)}else this.plotBtn.textContent="Quick Plot",this.finderDiv.style.zIndex="2",this.chartDiv.style.zIndex="1";else if(1==this.isBigQuery)if(this.isActive){this.plotBtn.textContent="Close Quick Plot",this.chartDiv.style.zIndex="2",this.finderDiv.style.zIndex="1";let e=new google.visualization.DataTable;"timestamp"===this.plotX.value?e.addColumn("datetime",this.plotX.value):e.addColumn("number",this.plotX.value),"timestamp"===this.plotY.value?e.addColumn("datetime",this.plotY.value):e.addColumn("number",this.plotY.value);for(let t=0;t<this.data[this.plotX.value].length;t++)e.addRow([this.data[this.plotX.value][t],this.data[this.plotY.value][t]]);let t=new google.visualization.LineChart(this.chartDiv),i={title:this.plotY.value,width:this.chartDiv.offsetWidth,height:this.chartDiv.offsetHeight,legend:"none",pointSize:10};t.draw(e,i)}else this.plotBtn.textContent="Quick Plot",this.finderDiv.style.zIndex="2",this.chartDiv.style.zIndex="1"}))}populateAxisFields(e){this.data=e,this.isBigQuery=!1;for(let t of Object.keys(e))if(Array.isArray(e[t])&&(t.includes("_dates")||t.toLowerCase().includes("times"))){let e=document.createElement("option");e.setAttribute("class","axis-options"),e.setAttribute("value",t),e.textContent=t,this.plotX.appendChild(e)}else if(Array.isArray(e[t])&&t.includes("_values")||t.toLowerCase().includes("values")){let e=document.createElement("option");e.setAttribute("class","axis-options"),e.setAttribute("value",t),e.textContent=t,this.plotY.appendChild(e)}}bqPopulateAxisFields(e,t){if(this.isBigQuery=!0,"eyedata"===t){let t={};e.forEach((e=>{for(let i of Object.keys(e))if("timestamp"===i)try{t[i].push(new Date(e[i].value))}catch{t[i]=[],t[i].push(new Date(e[i].value)),this.addAxisOption(i)}else try{t[i].push(parseFloat(e[i]))}catch{t[i]=[],t[i].push(parseFloat(e[i])),this.addAxisOption(i)}})),this.data=t}}addAxisOption(e){let t=document.createElement("option");t.setAttribute("class","axis-options"),t.setAttribute("value",e),t.textContent=e;let i=document.createElement("option");i.setAttribute("class","axis-options"),i.setAttribute("value",e),i.textContent=e,this.plotX.appendChild(t),this.plotY.appendChild(i)}removeElementsByClassName(e){var t;let i=document.getElementsByClassName(e);for(;i.length>0;)null===(t=i[0].parentNode)||void 0===t||t.removeChild(i[0])}}},66329:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mkquery=void 0;const s=i(15503),a=i(31644),l=i(81591),n=(0,a.getFunctions)((0,s.getApp)()),r=((0,a.httpsCallable)(n,"listTables"),(0,a.httpsCallable)(n,"bqQuery"));t.Mkquery=class{constructor(){this.rfidMode=!1}mkquery(e){let t;return t="",e.forEach((e=>{t+=this._mkquery(e.field,e.keyword)})),t}_mkquery(e,t){if(!e.toLowerCase().includes("date")){let i;return i=`where('${e}', '==', '${t}')`,i}{const i=864e5;let s,a;if(s=t.split(";"),2===s.length?s[1]=s[1].trim():s[1]="",a=new Date(s[0]),s[1].includes("+-")){let t,l,n,r;return n=Number(s[1].substring(2,s[1].length)),t=new Date(a.getTime()+n*i),l=new Date(a.getTime()-n*i),r=`.where("${e}", '>=', new Date(`+String(l.getTime())+")).where("+`"${e}", '<=', new Date(`+String(t.getTime())+"))",r}if(s[1].includes("+")&&!s[1].includes("-")){let t,l,n;return l=Number(s[1].substring(1,s[1].length)),t=new Date(a.getTime()+l*i),n=`.where("${e}", '>=', new Date(`+String(a.getTime())+")).where("+`"${e}", '<=', new Date(`+String(t.getTime())+"))",n}if(s[1].includes("-")&&!s[1].includes("+")){let t,l,n;return l=Number(s[1].substring(1,s[1].length)),t=new Date(a.getTime()+l*i),n=`.where("${e}", '>=', new Date(`+String(t.getTime())+")).where("+`"${e}", '<=', new Date(`+String(a.getTime())+"))",n}if(!s[1].includes("+")&&!s[1].includes("-")){let t,s;return t=new Date(a.getTime()+i),s=`.where("${e}", '>=', new Date(`+String(a.getTime())+")).where("+`"${e}", '<=', new Date(`+String(t.getTime())+"))",s}}}async decodeQuery(e){let t=new Array;return await(0,l.getDocs)(e).then((async e=>{if(e.empty)console.log("Found No Documents"),alert("Found No Documents");else{let i=e.docs.map((e=>async function(e,t){await t.push(e.data())}(e,t)));await Promise.all(i)}})).catch((e=>{console.error("Error Getting Documents:",e)})),t}mkbquery(e,t,i){let s=new Date(i),a=new Date(i);a.setDate(a.getDate()+1),s=s.toJSON().split("T")[0],a=a.toJSON().split("T")[0];let l=`SELECT *\n              FROM \`sandbox-ce2c5.${e}.${t}\`\n              WHERE timestamp BETWEEN '${s}' AND '${a}'\n              ORDER BY timestamp ASC`;return console.log("querystr",l),l}async decodeBigQuery(e){return await r(e)}}},80215:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseEngine=void 0;const s=i(70655),a=(0,s.__importStar)(i(55341)),l=(0,s.__importDefault)(i(83465)),n=(0,s.__importDefault)(i(68630)),r=(0,s.__importDefault)(i(1469));t.ParseEngine=class{constructor(){}generateParamObject(e,t){let i=(0,l.default)(e);console.log(i);let s=1,a=1,o=1,d=["CAMERAS","LIGHTS","OBJECTS","IMAGES","durationMS","IMAGEFILTERS","OBJECTFILTERS"];return d.forEach(((e,t)=>{if((0,r.default)(i[e])&&i[e].length>0)i[e]=this.parseAndGenerate2(i[e]),s*=i[e].length,a=i[e].length>a?a:i[e].length,o=o>i[e].length?o:i[e].length;else if((0,n.default)(i[e]))for(let t in i[e])if((0,r.default)(i[e][t])&&i[e][t].length>0)i[e][t]=this.parseAndGenerate2(i[e][t]),s*=i[e][t].length,a=i[e][t].length>a?a:i[e][t].length,o=o>i[e][t].length?o:i[e][t].length;else if((0,n.default)(i[e][t]))for(let l in i[e][t])if((0,r.default)(i[e][t][l])&&i[e][t][l].length>0)i[e][t][l]=this.parseAndGenerate2(i[e][t][l]),s*=i[e][t][l].length,a=i[e][t][l].length>a?a:i[e][t][l].length,o=o>i[e][t][l].length?o:i[e][t][l].length;else if((0,n.default)(i[e][t][l]))for(let n in i[e][t][l])(0,r.default)(i[e][t][l][n])&&i[e][t][l][n].length>0&&(i[e][t][l][n]=this.parseAndGenerate2(i[e][t][l][n]),s*=i[e][t][l][n].length,a=i[e][t][l][n].length>a?a:i[e][t][l][n].length,o=o>i[e][t][l][n].length?o:i[e][t][l][n].length)})),"vectorize"==t?d.forEach(((e,t)=>{if((0,r.default)(i[e])&&i[e].length>1){let t=[];for(let a=0;a<s;a++)t.push(i[e][a%i[e].length]);i[e]=t}else if((0,n.default)(i[e]))for(let t in i[e])if((0,r.default)(i[e][t])&&i[e][t].length>1){let a=[];for(let l=0;l<s;l++)a.push(i[e][t][l%i[e][t].length]);i[e][t]=a}else if((0,n.default)(i[e][t]))for(let a in i[e][t])if((0,r.default)(i[e][t][a])&&i[e][t][a].length>1){let l=[];for(let n=0;n<s;n++)l.push(i[e][t][a][n%i[e][t][a].length]);i[e][t][a]=l}else if((0,n.default)(i[e][t][a]))for(let l in i[e][t][a])if((0,r.default)(i[e][t][a][l])&&i[e][t][a][l].length>1){let n=[];for(let r=0;r<s;r++)n.push(i[e][t][a][l][r%i[e][t][a][l].length]);i[e][t][a][l]=n}})):"expand"==t&&d.forEach(((e,t)=>{if((0,r.default)(i[e])&&i[e].length>1&&i[e].length!=o){let t=new Error(`Length Mismatch: ${e}.length=${i[e].length} != maxLen=${o}`);throw alert(t.message),t}if((0,n.default)(i[e]))for(let t in i[e]){if((0,r.default)(i[e][t])&&i[e][t].length>1&&i[e][t].length!=o){let s=new Error(`Length Mismatch: ${e}[${t}].length=${i[e][t].length} != maxLen=${o}`);throw alert(s.message),s}if((0,n.default)(i[e][t]))for(let s in i[e][t]){if((0,r.default)(i[e][t][s])&&i[e][t][s].length>1&&i[e][t][s].length!=o){let a=new Error(`Length Mismatch: ${e}[${t}][${s}].length=${i[e][t][s].length} != maxLen=${o}`);throw alert(a.message),a}if((0,n.default)(i[e][t][s]))for(let a in i[e][t][s])if((0,r.default)(i[e][t][s][a])&&i[e][t][s][a].length>1&&i[e][t][s][a].length!=o){let l=new Error(`Length Mismatch: ${e}[${t}][${s}][${a}].length=${i[e][t][s][a].length} != maxLen=${o}`);throw alert(l.message),l}}}})),console.log("userObj",i,"totalLen:",s),i}genParamObj(e,t){if("CAMERAS"==e)for(let e in t)t.hasOwnProperty(e)&&(t[e].position=this.vectorize(t[e].position,"cartesianObj"),t[e].targetInches=this.vectorize(t[e].targetInches,"cartesianObj"),t[e].visible=this.vectorize(t[e].visible,"array"));else if("LIGHTS"==e)for(let e in t)t.hasOwnProperty(e)&&(t[e].position=this.vectorize(t[e].position,"cartesianObj"),t[e].intensity=this.vectorize(t[e].intensity,"array"),t[e].visible=this.vectorize(t[e].visible,"array"));else if("OBJECTS"==e)for(let e in t)t.hasOwnProperty(e)&&(t[e].positionInches=this.vectorize(t[e].positionInches,"cartesianObj"),t[e].rotationDegrees=this.vectorize(t[e].rotationDegrees,"cartesianObj"),t[e].sizeInches=this.vectorize(t[e].sizeInches,"array"),t[e].material.opacity=this.vectorize(t[e].material.opacity,"array"),t[e].visible=this.vectorize(t[e].visible,"array"));else"IMAGES"==e&&(t.imageidx=this.vectorize(t.imageidx,"array"))}normal(e,t,i){let s=a.random([i]),l=a.random([i]),n=a.multiply(-2,a.log(s)),r=a.multiply(2*a.pi,l),o=a.dotMultiply(a.sqrt(n),a.cos(r));return a.add(e,a.multiply(o,t))}parseAndGenerate2(e){let t;if("[object String]"!==Object.prototype.toString.call(e[0]))return e;{let i=e[0].split("/");if("normal"==i[0]||"n"==i[0]){console.log("row:",e),console.log("recipe:",i);let s=Number(i[1].split(",")[0]),a=Number(i[1].split(",")[1]),l=Number(i[2]);t=this.normal(s,a,l),console.log(t)}else if("uniform"==i[0]||"u"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=[Number(i[2])];t=a.random(l,e,s)}else if("range"==i[0]||"r"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=Number(i[2]),n=a.range(e,s,l);t=[],n.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}else if("linspace"==i[0]||"l"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=(s-e)/(Number(i[2])-1),n=a.range(e,s,l,!0);t=[],n.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}else if("movie"==i[0]||"m"==i[0]){let e=i[1].split(","),s=[];e.forEach((e=>{s.push(Number(parseFloat(e).toPrecision(4)))})),t=[],t.push(s)}else{let e=i[0].split(",");t=[],e.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}}return t}parseAndGenerate(e){let t;if("[object String]"===Object.prototype.toString.call(e)){let i=e.split("/");if("normal"==i[0]||"n"==i[0]){console.log("row:",e);let s=Number(i[1].split(",")[0]),a=Number(i[1].split(",")[1]),l=Number(i[2]);t=this.normal(s,a,l)}else if("uniform"==i[0]||"u"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=[Number(i[2])];t=a.random(l,e,s)}else if("range"==i[0]||"r"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=Number(i[2]),n=a.range(e,s,l);t=[],n.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}else if("linspace"==i[0]||"l"==i[0]){let e=Number(i[1].split(",")[0]),s=Number(i[1].split(",")[1]),l=(s-e)/(Number(i[2])-1),n=a.range(e,s,l,!0);t=[],n.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}else if("movie"==i[0]||"m"==i[0]){let e=i[1].split(","),s=[];e.forEach((e=>{s.push(Number(parseFloat(e).toPrecision(4)))})),t=[],t.push(s)}else{let e=i[0].split(",");t=[],e.forEach((e=>{t.push(Number(parseFloat(e).toPrecision(4)))}))}}else 0==isNaN(e)&&(console.log("single number",e),t=[],t.push(e));return t}vectorize(e,t){let i;if("array"==t)i=[],e.forEach((e=>{i.push(...this.parseAndGenerate(e))}));else if("cartesianObj"==t){i={x:[],y:[],z:[]};let t={x:[],y:[],z:[]};for(let i in e)e.hasOwnProperty(i)&&e[i].forEach((e=>{t[i].push(...this.parseAndGenerate(e))}));t.x.length!=t.y.length||t.y.length!=t.z.length?t.x.forEach((e=>{t.y.forEach((s=>{t.z.forEach((t=>{i.x.push(e),i.y.push(s),i.z.push(t)}))}))})):(i.x=t.x,i.y=t.y,i.z=t.z)}return i}}},75042:()=>{}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var l=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(l.exports,l,l.exports,s),l.loaded=!0,l.exports}s.m=t,s.amdD=function(){throw new Error("define cannot be used indirect")},s.amdO={},e=[],s.O=(t,i,a,l)=>{if(!i){var n=1/0;for(c=0;c<e.length;c++){for(var[i,a,l]=e[c],r=!0,o=0;o<i.length;o++)(!1&l||n>=l)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(r=!1,l<n&&(n=l));if(r){e.splice(c--,1);var d=a();void 0!==d&&(t=d)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[i,a,l]},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,l,[n,r,o]=i,d=0;if(n.some((t=>0!==e[t]))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(o)var c=o(s)}for(t&&t(i);d<n.length;d++)l=n[d],s.o(e,l)&&e[l]&&e[l][0](),e[n[d]]=0;return s.O(c)},i=self.webpackChunkmkfiles=self.webpackChunkmkfiles||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[410],(()=>s(48519)));a=s.O(a)})();
//# sourceMappingURL=main.bundle.js.map